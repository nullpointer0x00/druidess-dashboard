<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>
<div class="panel panel-success panel-collapse" th:fragment="task-table">
    <div class="panel-heading">
        <p class="panel-title pull-left" th:text="${type + ' Tasks'}" />
        <form th:action="@{/kill-all}"
              th:object="${tasks}" method="post">
            <button type="submit" class="btn btn-danger btn-xs pull-right"
                    th:classappend="${tasks.empty} ? 'hidden' : ''"
                    data-toggle="confirmation" th:text="${'Kill All'}">

            </button>
        </form>
        <form th:action="@{/kill-selected}"
              th:object="${tasks}" method="post">
            <button type="submit" class="btn btn-danger btn-xs pull-right"
                    th:classappend="${tasks.empty} ? 'hidden' : ''"
                    data-toggle="confirmation" th:text="${'Kill Selected'}">
            </button>
        </form>
        <div class="clearfix"></div>
    </div>
    <table th:id="${tableId}" class="taskTable display table table-sm table-dark table-striped">
        <thead>
        <tr>
            <th></th>
            <th>Id</th>
            <th>Status Code</th>
            <th>Duration</th>
            <th>Host</th>
            <th class="no-sort">Port</th>
            <th class="no-sort"></th>
            <th class="no-sort"></th>
            <th class="no-sort"></th>
        </tr>
        </thead>
        <tbody>
        <th:block th:each="task : ${tasks}">
            <tr>
                <td>
                    <input type="checkbox" th:field="*{task.isSelected}"/>
                </td>
                <td th:text="${task.taskStatus.id}">Task Id</td>
                <td th:text="${task.taskStatus.statusCode}">Status Code</td>
                <td th:text="${task.taskStatus.duration}">Duration</td>
                <td th:text="${task.taskStatus.location.host}">Host</td>
                <td th:text="${task.taskStatus.location.port}">Port</td>
                <td><a class="glyphicon glyphicon-cog"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId}"></a></td>
                <td><a class="glyphicon glyphicon-time"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId + '/status'}"></a>
                </td>
                <td><a class="glyphicon glyphicon-book"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId + '/log'}"></a>
                </td>
            </tr>
        </th:block>
        </tbody>
    </table>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function () {
            $([[${'#' + tableId}]]).DataTable({
                aLengthMenu: [
                    [25, 50, 100, 500, -1],
                    [25, 50, 100, 500, "All"]
                ],
                iDisplayLength: 25,
                columnDefs: [{
                    targets: 'no-sort',
                    orderable: false,
                }]
            });
            $('[data-toggle=confirmation]').confirmation({
                rootSelector: '[data-toggle=confirmation]',
                // other options
            });
        });
        /*]]>*/
    </script>
</div>
<div class="panel panel-primary" th:fragment="completed-task-table(tasks)">
    <div class="panel-heading">
        <p class="panel-title" th:text="${'Completed'}" />
    </div>
    <table th:id="${tableId}" class="taskTable display table table-sm table-dark table-striped">
        <thead>
        <tr>
            <th>Id</th>
            <th>Status Code</th>
            <th>Duration</th>
            <th>Host</th>
            <th class="no-sort">Port</th>
            <th class="no-sort"></th>
            <th class="no-sort"></th>
            <th class="no-sort"></th>
        </tr>
        </thead>
        <tbody>
        <th:block th:each="task : ${tasks}">
            <tr>
                <td th:text="${task.taskStatus.id}">Task Id</td>
                <td><span class="label"
                          th:classappend="${task.taskStatus.statusCode == task.taskStatus.statusCode.FAILED ? 'label-danger' : 'label-success'}"
                          th:text="${task.taskStatus.statusCode}"></span></td>
                <td th:text="${task.taskStatus.duration}">Duration</td>
                <td th:text="${task.taskStatus.location.host}">Host</td>
                <td th:text="${task.taskStatus.location.port}">Port</td>
                <td><a class="glyphitaskStatus.con glyphicon-cog"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId}"></a></td>
                <td><a class="glyphicon glyphicon-time"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId + '/status'}"></a>
                </td>
                <td><a class="glyphicon glyphicon-book"
                       th:href="${ session.env.overlordUrl + '/druid/indexer/v1/task/' + task.urlEncodedId + '/log'}"></a>
                </td>
            </tr>
        </th:block>
        </tbody>
    </table>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function () {
            $([[${'#' + tableId}]]).DataTable({
                aLengthMenu: [
                    [25, 50, 100, 500, -1],
                    [25, 50, 100, 500, "All"]
                ],
                iDisplayLength: 25,
                columnDefs: [{
                    targets: 'no-sort',
                    orderable: false,
                }]
            });
            $('[data-toggle=confirmation]').confirmation({
                rootSelector: '[data-toggle=confirmation]',
                // other options
            });
        });
        /*]]>*/
    </script>
</div>
</body>
</html>